<!DOCTYPE html>
<html>
  <head>
    <title>AMLL Web Player</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#222222" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="AMLL Web Player" />
    <link rel="icon" href="./assets/icon-96x96.png" />
    <link rel="manifest" href="./public/manifest.json" />
    <link rel="apple-touch-icon" href="./public/icons/icon-192x192.png" />
    <script src="./public/jsmediatags.min.js"></script>
    <script>
      // 检查jsmediatags库是否加载成功
      window.addEventListener("load", () => {
        console.log("Checking local jsmediatags library...");

        if (window.jsmediatags) {
          console.log("[SUCCESS] jsmediatags library loaded successfully");
          console.log("Version:", window.jsmediatags.version);
          console.log("Available methods:", Object.keys(window.jsmediatags));
        } else {
          console.log("[ERROR] jsmediatags library failed to load");
        }
      });
    </script>
    <script type="module" src="./src/main.ts" defer></script>
    <style>
      :root {
        font-family: "Noto Sans SC", "SF Pro Display", "PingFang SC", system-ui,
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      }

      .amll-lyric-player:hover ._lyricLine_1vq69_6,
      .amll-lyric-player:hover ._lyricLine_1ygrf_6 {
        filter: inherit !important;
      }

      ._lyricLine_1vq69_6:has(> *):hover,
      ._lyricLine_1vq69_6:has(> *):active,
      ._lyricLine_1ygrf_6:has(> *):hover,
      ._lyricLine_1ygrf_6:has(> *):active {
        background-color: transparent !important;
      }

      body {
        max-width: 100vw;
        width: 100vw;
        max-height: 100vh;
        height: 100vh;
        overflow: hidden;
        background: #222;
        margin: 0;
      }

      #player {
        max-height: 100vh;
        height: 100vh;
        max-width: 100vw;
        width: 100vw;
        overflow: hidden;
        position: relative;
      }

      #controlPanel {
        position: fixed;
        top: 120px;
        bottom: 60px;
        right: 20px;
        border-radius: 24px;
        padding: 15px;
        color: white;
        display: none;
        z-index: 1000;
        width: 320px;
        max-height: calc(100vh - 40px);
        overflow-y: auto;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.18);
      }

      .control-group {
        margin-bottom: 8px;
      }

      .control-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: rgba(255, 255, 255, 0.8);
      }

      .control-group input[type="text"],
      .control-group input[type="file"] {
        width: 100%;
        padding: 8px 12px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 24px;
        background: rgba(255, 255, 255, 0.1);
        color: rgba(255, 255, 255, 0.8);
        font-size: 14px;
        box-sizing: border-box;
        margin-bottom: 8px;
      }

      .control-group input[type="file"] {
        width: 100%;
        padding: 6px;
      }

      .control-group input[type="text"]::placeholder {
        color: rgba(255, 255, 255, 0.8);
      }

      .btn {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.18);
        color: rgba(255, 255, 255, 0.8);
        padding: 8px 16px;
        border-radius: 24px;
        cursor: pointer;
        font-size: 14px;
        margin-right: 8px;
        margin-bottom: 8px;
        transition: opacity 0.3s ease;
      }

      .btn:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      #playControls {
        position: fixed;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        border-radius: 8px;
        color: white;
        z-index: 1000;
        display: flex;
        align-items: center;
        gap: 8px;
        opacity: 0;
        transition: opacity 0.3s ease;
        user-select: none;
        -webkit-user-select: none;
        -webkit-touch-callout: none;
      }

      body:hover #playControls {
        opacity: 1;
      }

      .play-btn {
        background: none;
        border: none;
        color: rgba(255, 255, 255, 0.6);
        font-size: 20px;
        cursor: pointer;
        padding: 6px;
        vertical-align: middle;
        line-height: 0.5;
      }

      #progressBar {
        width: 60vw;
        min-width: 120px;
        max-width: 600px;
        height: 8px;
        border-radius: 4px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        border: 1px solid rgba(255, 255, 255, 0.18);
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }

      #playbackRate,
      #volumeControl {
        position: relative;
        cursor: pointer;
      }

      .control-value {
        font-size: 12px;
        color: rgba(255, 255, 255, 0.6);
      }

      #progressFill {
        height: 100%;
        background: white;
        width: 0%;
        transition: width 0.1s ease;
        position: relative;
      }

      #progressFill[style*="width: 0%"],
      #progressFill[style*="width:0%"] {
        border-radius: 6px 0 0 6px;
      }

      #progressFill[style*="width: 100%"],
      #progressFill[style*="width:100%"] {
        border-radius: 6px;
      }

      #timeDisplay {
        font-size: 14px;
        color: rgba(255, 255, 255, 0.8);
        min-width: 100px;
        text-align: center;
      }

      #songInfoTopLeft {
        position: fixed;
        top: 20px;
        left: 20px;
        background: transparent;
        border-radius: 8px;
        padding: 15px;
        color: white;
        z-index: 1000;
        display: none;
        max-width: 300px;
        cursor: pointer;
        transition: transform 0.2s ease, background 0.2s ease;
      }

      #songInfoTopLeft .song-cover {
        width: 60px;
        height: 60px;
        border-radius: 8px;
        object-fit: cover;
        margin-right: 15px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      }

      #songInfoTopLeft .song-info {
        display: flex;
        align-items: center;
      }

      #songInfoTopLeft .song-title {
        font-weight: bold;
        font-size: 16px;
        margin-bottom: 4px;
        color: white;
      }

      #songInfoTopLeft .song-artist {
        color: rgba(255, 255, 255, 0.8);
        font-size: 14px;
      }

      @media (min-width: 769px), (orientation: landscape) {
        #player {
          display: flex;
          flex-direction: row;
        }

        #albumSidePanel {
          width: 50%;
          min-width: 300px;
          height: 100vh;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          padding: 40px 20px 60px;
          box-sizing: border-box;
          position: relative;
          z-index: 10;
        }

        #albumCoverLarge {
          width: 70%;
          max-width: 512px;
          aspect-ratio: 1/1;
          border-radius: 12px;
          background: rgba(255, 255, 255, 0.1);
          backdrop-filter: blur(10px);
          -webkit-backdrop-filter: blur(10px);
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
          margin-bottom: 24px;
          object-fit: cover;
          cursor: pointer;
          position: relative;
        }

        #albumInfo {
          width: 70%;
          max-width: 512px;
          text-align: center;
          color: white;
          cursor: pointer;
        }

        #songTitle {
          font-size: 24px;
          font-weight: bold;
          margin-bottom: 6px;
          transition: color 0.2s ease;
        }

        #songTitle:hover {
          color: rgba(255, 255, 255, 0.9);
        }

        #songArtist {
          font-size: 18px;
          color: rgba(255, 255, 255, 0.8);
          transition: color 0.2s ease;
        }

        #songArtist:hover {
          color: rgba(255, 255, 255, 1);
        }

        #lyricsPanel {
          width: 70%;
          height: 100vh;
          position: relative;
        }

        #songInfoTopLeft {
          display: none !important;
        }

        .amll-lyric-player {
          padding-top: 20px !important;
        }
      }

      @media (max-width: 768px) and (orientation: portrait) {
        #albumSidePanel {
          display: none;
        }

        #lyricsPanel {
          width: 100%;
          height: 100vh;
        }

        #controlPanel {
          max-width: calc(100vw - 40px);
          left: 20px;
          right: 20px;
        }

        /* 确保在小屏幕上播放速度和音量控制能够正确显示 */
        #playbackRate,
        #volumeControl {
          width: 100% !important;
        }

        /* 在小屏幕上减小间距 */
        [style*="display: flex; gap: 10px;"] {
          gap: 5px !important;
        }

        #playControls {
          width: calc(100vw - 40px);
          left: 20px;
          right: 20px;
          transform: none;
        }

        #progressBar {
          width: 200px;
        }
      }

      .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(255, 255, 255, 0.3);
        border-radius: 50%;
        border-top-color: #fff;
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      #status {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 20px 30px;
        border-radius: 12px;
        z-index: 2000;
        display: none;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      #lyricAreaHint {
        transition: opacity 0.3s ease;
      }

      #lyricsPanel:hover #lyricAreaHint {
        opacity: 0.9 !important;
      }
    </style>
  </head>

  <body>
    <div id="songInfoTopLeft">
      <div class="song-info">
        <img class="song-cover" id="songCoverTopLeft" src="" alt="封面" />
        <div>
          <div class="song-title" id="songTitleTopLeft" data-i18n="songTitle">
            Song Title
          </div>
          <div
            class="song-artist"
            id="songArtistTopLeft"
            data-i18n="songArtist"
          >
            Artist
          </div>
        </div>
      </div>
    </div>

    <div id="controlPanel">
      <div class="control-group">
        <label data-i18n="musicFile">Music File</label>
        <input
          type="file"
          id="musicFile"
          accept="audio/*,.mp3,.wav,.ogg,.m4a,.aac,.flac"
        />
        <input
          type="text"
          id="musicUrl"
          data-i18n-placeholder="musicUrl"
          placeholder="or enter music URL"
        />
      </div>

      <div class="control-group">
        <label data-i18n="lyricsFile">Lyrics File</label>
        <input
          type="file"
          id="lyricFile"
          accept="text/plain,.lrc,.ttml,.yrc,.lys,.qrc"
        />
        <input
          type="text"
          id="lyricUrl"
          data-i18n-placeholder="lyricsUrl"
          placeholder="or enter lyrics URL"
        />
        <!-- <div
        style="
          font-size: 12px;
          color: rgba(255, 255, 255, 0.6);
          margin-top: -4px;
          margin-bottom: 8px;
        "
        data-i18n="supportedLyricFormats"
      >
      Supports LyRiC / LyRiC A2 / LyRiC Walaoke / ESLyRiC / Salt Player ESLyRiC (*.lrc, *.spl), Apple Music (*.ttml, *.json), Netease Music (*.yrc), Lyricsify (*.lys, *.lyl, *.lqe), QQMusic (*.qrc), KuGou (*.krc), ALRC (*.alrc, *.json), SubRip (*.srt), Aegisub (*.ass), Musixmatch (*.json) formats
      </div> -->
      </div>

      <div class="control-group">
        <label data-i18n="coverImage">Cover Image</label>
        <input type="file" id="coverFile" accept="image/*" />
        <input
          type="text"
          id="coverUrl"
          data-i18n-placeholder="coverUrl"
          placeholder="or enter cover image URL"
        />
      </div>

      <div class="control-group">
        <label data-i18n="songInfo">Song Information</label>
        <input
          type="text"
          id="songTitleInput"
          data-i18n-placeholder="title"
          placeholder="Title"
        />
        <input
          type="text"
          id="songArtistInput"
          data-i18n-placeholder="artist"
          placeholder="Artist"
        />
      </div>

      <div class="control-group">
        <label data-i18n="playbackControl">Playback Control</label>
        <div
          style="
            display: flex;
            align-items: center;
            margin-bottom: 12px;
            gap: 16px;
          "
        >
          <div style="display: flex; align-items: center">
            <input type="checkbox" id="loopPlay" checked />
            <span class="control-value" data-i18n="loopPlay"
              >Loop Playback</span
            >
          </div>
          <div style="flex: 1; display: flex; align-items: center; gap: 10px">
            <input
              type="number"
              id="lyricDelayInput"
              value="0"
              step="100"
              placeholder="0"
              style="
                width: 80px;
                padding: 8px 12px;
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 24px;
                background: rgba(255, 255, 255, 0.1);
                color: rgba(255, 255, 255, 0.8);
                font-size: 14px;
                box-sizing: border-box;
              "
            />
            <span class="control-value">ms</span>
          </div>
        </div>

        <div style="display: flex; gap: 10px; margin-top: 10px">
          <div style="flex: 1; text-align: center">
            <span class="control-value" data-i18n="playbackRate"
              >Playback Speed</span
            >
            <input
              type="range"
              id="playbackRate"
              min="0.10"
              max="4.00"
              step="0.05"
              value="1.00"
              style="width: 100%; margin: 8px 0"
            />
            <div
              style="
                display: flex;
                justify-content: space-between;
                margin-bottom: 5px;
              "
            >
              <span class="control-value">0.10x</span>
              <span id="playbackRateValue" class="control-value">1.00x</span>
              <span class="control-value">4.00x</span>
            </div>
          </div>

          <div style="flex: 1; text-align: center">
            <span class="control-value" data-i18n="volume">Volume</span>
            <input
              type="range"
              id="volumeControl"
              min="0"
              max="100"
              step="1"
              value="50"
              style="width: 100%; margin: 8px 0"
            />
            <div
              style="
                display: flex;
                justify-content: space-between;
                margin-bottom: 5px;
              "
            >
              <span class="control-value">0%</span>
              <span id="volumeValue" class="control-value">50%</span>
              <span class="control-value">100%</span>
            </div>
          </div>
        </div>
      </div>

      <div style="margin-top: 16px">
        <button class="btn" id="loadFromUrl" data-i18n="loadFromUrl">
          Load from URL
        </button>
        <button class="btn" id="loadFiles" data-i18n="loadFiles">
          Load Files
        </button>
        <button class="btn" id="resetPlayer" data-i18n="resetPlayer">
          Reset Player
        </button>
      </div>
    </div>

    <div id="playControls">
      <button class="play-btn" id="playPauseBtn">
        <svg
          fill="currentColor"
          class="___12fm75w f1w7gpdv fez10in fg4l7m0"
          aria-hidden="true"
          width="1em"
          height="1em"
          viewBox="0 0 20 20"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M17.22 8.68a1.5 1.5 0 0 1 0 2.63l-10 5.5A1.5 1.5 0 0 1 5 15.5v-11A1.5 1.5 0 0 1 7.22 3.2l10 5.5Z"
            fill="currentColor"
          ></path>
        </svg>
      </button>
      <div id="progressBar">
        <div id="progressFill"></div>
      </div>
      <div id="timeDisplay" class="control-value">00:00 / 00:00</div>
      <button class="play-btn" id="fullscreenBtn">⛶</button>
    </div>

    <div id="status">
      <div id="statusText" class="control-value"></div>
    </div>

    <div id="player">
      <div id="albumSidePanel">
        <img
          id="albumCoverLarge"
          src="./assets/icon-512x512.png"
          alt="歌曲封面"
        />
        <div id="albumInfo">
          <div id="songTitle" data-i18n="songTitle">Song Title</div>
          <div id="songArtist" data-i18n="songArtist">Artist</div>
        </div>
      </div>
      <div id="lyricsPanel" style="position: relative"></div>
    </div>
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("./public/service-worker.js")
            .then((registration) => {
              console.log(
                "Service Worker registered successfully:",
                registration.scope
              );
            })
            .catch((error) => {
              console.log("Service Worker registration failed:", error);
            });
        });
      }
    </script>
  </body>
</html>
